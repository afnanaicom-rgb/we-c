<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Afnan AI - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            font-family: 'Noto Sans Arabic', sans-serif; 
        }
        body, html { 
            height: 100%; 
            margin: 0; 
            color: #1a1a1a; 
            overflow-x: hidden; 
            transition: background-color 0.3s ease;
        }
        
        /* Theme Variables - Updated to White and Light Cyan */
        :root {
            --bg-primary: #f0f9ff; /* Light Cyan background */
            --bg-secondary: #ffffff; /* White */
            --bg-card: #ffffff;
            --bg-surface: #e0f2fe;
            --text-primary: #0c4a6e;
            --text-secondary: #334155;
            --accent: #0ea5e9; /* Cyan accent */
            --accent-secondary: #00d4aa;
            --accent-magic: #9d4edd;
            --border-color: #bae6fd;
            --gradient-primary: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
            --gradient-secondary: linear-gradient(135deg, #00d4aa 0%, #00f5d4 100%);
            --gradient-magic: linear-gradient(135deg, #9d4edd 0%, #c77dff 100%);
        }
        
        .dark-mode {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --bg-surface: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
        }
        
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }
        
        /* Enhanced Header */
        .app-header { 
            position: fixed; 
            top: 0; 
            right: 0; 
            left: 0; 
            height: 70px; 
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(20px); 
            border-bottom: 1px solid var(--border-color); 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            padding: 0 1.5rem; 
            z-index: 1000; 
            transition: all 0.3s ease;
        }
        
        .dark-mode .app-header {
            background: rgba(15, 23, 42, 0.9);
        }
        
        /* Sidebar */
        #sidebar {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Profile Avatar - Smaller */
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent);
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }
        
        /* Level System - Cleaned up */
        .level-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            margin: 0.5rem 1rem;
            background: transparent; /* Removed the box */
            border: none; /* Removed the border */
        }
        
        .level-info {
            width: 100%;
            text-align: center;
        }
        
        .level-current {
            font-size: 28px;
            font-weight: 900;
            color: var(--accent);
            line-height: 1;
            margin-bottom: 4px;
        }
        
        .level-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .level-progress {
            width: 100%;
            height: 6px;
            background: var(--bg-surface);
            border-radius: 10px;
            overflow: hidden;
            margin: 0.5rem 0;
        }
        
        .level-progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .level-image {
            width: 60px;
            height: 60px;
            object-fit: contain;
            margin-top: 10px;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }

        /* Edit Profile Button */
        .edit-profile-btn {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(50%);
            background: var(--accent);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--bg-secondary);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 10;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 5000;
            padding: 20px;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--bg-secondary);
            padding: 24px;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .input-group { margin-bottom: 16px; }
        .input-group label { display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600; }
        .input-group input {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 16px; }
        .stat-card { background: var(--bg-surface); padding: 12px; border-radius: 16px; text-align: center; }
        .stat-value { font-weight: bold; font-size: 18px; }
        .stat-label { font-size: 12px; color: var(--text-secondary); }
        
        .secondary-btn { background: var(--bg-surface); color: var(--text-primary); border-radius: 12px; padding: 8px; transition: all 0.2s; }
        .modern-btn { background: var(--gradient-primary); color: white; border-radius: 12px; padding: 12px; font-weight: bold; width: 100%; }
        
        .view-screen { display: none; padding-top: 80px; padding-bottom: 100px; }
        .view-screen.active { display: block; }
        
        .fade-in { animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="light">

<!-- Edit Profile Modal -->
<div id="editProfileModal" class="modal">
    <div class="modal-content">
        <h3 class="text-xl font-bold mb-6">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h3>
        <div class="input-group">
            <label>Ø§Ù„Ø§Ø³Ù…</label>
            <input type="text" id="editNameInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
        </div>
        <div class="input-group">
            <label>Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙÙŠÙ„</label>
            <input type="text" id="editAvatarInput" placeholder="https://example.com/image.jpg">
        </div>
        <div class="flex gap-3 mt-6">
            <button onclick="saveProfileChanges()" class="modern-btn flex-1">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
            <button onclick="closeEditModal()" class="secondary-btn flex-1">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>
</div>

<!-- Main App -->
<div id="main-app">
    <!-- Header -->
    <header class="app-header">
        <div class="flex items-center gap-3">
            <button onclick="toggleSidebar()" class="secondary-btn">
                <i data-lucide="menu" class="w-5 h-5"></i>
            </button>
            <h1 id="view-title" class="text-lg font-bold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h1>
        </div>
        
        <div class="flex items-center gap-3">
            <div class="theme-toggle" onclick="toggleTheme()">
                <i data-lucide="sun" class="w-5 h-5"></i>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <div id="sidebar" class="fixed top-0 right-[-320px] w-80 h-full z-[4000] transition-all duration-300 border-l border-var(--border-color) flex flex-col shadow-2xl">
        <div class="p-6 text-center border-b border-var(--border-color)">
            <div class="relative inline-block mb-6">
                <div class="relative">
                    <img id="userAvatar" src="https://via.placeholder.com/80" class="profile-avatar">
                    <img id="activeFrame" src="" class="absolute inset-0 w-full h-full" style="display: none;">
                    <button onclick="openEditModal()" class="edit-profile-btn">
                        <i data-lucide="edit-2" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
            
            <h2 id="userName" class="text-xl font-bold mb-1">...</h2>
            <div class="text-xs text-var(--text-secondary) mb-4 font-mono" id="userID">ID: 00000000</div>
            
            <!-- Level Display - Simplified -->
            <div class="level-display">
                <div class="level-info">
                    <div class="level-label">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
                    <div class="level-current" id="currentLevel">1</div>
                    <div class="level-progress">
                        <div id="levelProgressBar" class="level-progress-bar" style="width: 20%"></div>
                    </div>
                    <div class="text-[10px] text-var(--text-secondary) mt-1">
                        <span id="currentXP">0</span> / <span id="nextLevelXP">1000</span> XP
                    </div>
                </div>
                <!-- Badge/Level Image from Firebase -->
                <img id="levelImage" src="" class="level-image" onerror="this.style.display='none'">
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="walletBalance">0</div>
                    <div class="stat-label">ğŸ’ Ø±ØµÙŠØ¯</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="giftCount">0</div>
                    <div class="stat-label">ğŸ Ù‡Ø¯Ø§ÙŠØ§</div>
                </div>
            </div>
        </div>
        
        <nav class="p-4 space-y-2 flex-1 overflow-y-auto">
            <button onclick="switchView('home')" class="w-full flex items-center gap-4 p-3 hover:bg-var(--bg-surface) rounded-xl transition-all">
                <i data-lucide="home" class="w-5 h-5 text-var(--accent)"></i>
                <span class="font-medium">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </button>
            <button onclick="switchView('profile')" class="w-full flex items-center gap-4 p-3 hover:bg-var(--bg-surface) rounded-xl transition-all">
                <i data-lucide="user" class="w-5 h-5 text-var(--accent)"></i>
                <span class="font-medium">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</span>
            </button>
            <button onclick="switchView('gifts')" class="w-full flex items-center gap-4 p-3 hover:bg-var(--bg-surface) rounded-xl transition-all">
                <i data-lucide="gift" class="w-5 h-5 text-var(--accent-magic)"></i>
                <span class="font-medium">Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§</span>
            </button>
        </nav>
        
        <div class="p-4 border-t border-var(--border-color)">
            <button onclick="logout()" class="w-full p-3 bg-red-50 text-red-600 rounded-xl font-bold text-sm hover:bg-red-100 transition-all">
                ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
            </button>
        </div>
    </div>

    <!-- Content Area -->
    <main>
        <div id="view-home" class="view-screen active px-4">
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-sky-100 mb-6">
                <h2 class="text-2xl font-black text-sky-900 mb-2">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Afnan AI</h2>
                <p class="text-sky-600">Ø§Ø³ØªÙƒØ´Ù Ø¹Ø§Ù„Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ±</p>
            </div>
        </div>
        
        <div id="view-profile" class="view-screen px-4">
            <h2 class="text-xl font-bold mb-4">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
            <!-- Profile content here -->
        </div>
    </main>
</div>

<script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Firebase Config (User should provide this, using placeholders)
    const firebaseConfig = {
        // Your config here
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let uData = null;

    // Initialize Lucide Icons
    lucide.createIcons();

    // Sidebar Toggle
    window.toggleSidebar = () => {
        const sidebar = document.getElementById('sidebar');
        const isOpen = sidebar.style.right === '0px';
        sidebar.style.right = isOpen ? '-320px' : '0px';
    };

    // Theme Toggle
    window.toggleTheme = () => {
        document.body.classList.toggle('dark-mode');
    };

    // Switch Views
    window.switchView = (viewId) => {
        document.querySelectorAll('.view-screen').forEach(v => v.classList.remove('active'));
        const targetView = document.getElementById(`view-${viewId}`);
        if (targetView) targetView.classList.add('active');
        document.getElementById('view-title').textContent = 
            viewId === 'home' ? 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©' : 
            viewId === 'profile' ? 'Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ' : 'Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§';
        toggleSidebar();
    };

    // Real-time Profile Updates
    onAuthStateChanged(auth, (user) => {
        if (user) {
            onSnapshot(doc(db, "users", user.uid), (doc) => {
                if (doc.exists()) {
                    uData = doc.data();
                    updateUI();
                }
            });
        }
    });

    function updateUI() {
        if (!uData) return;
        
        document.getElementById('userName').textContent = uData.name || 'Ù…Ø³ØªØ®Ø¯Ù…';
        document.getElementById('userAvatar').src = uData.avatar || 'https://via.placeholder.com/80';
        document.getElementById('userID').textContent = `ID: ${uData.id || '00000000'}`;
        document.getElementById('walletBalance').textContent = uData.balance || 0;
        
        // Level System
        const level = uData.level || 1;
        const xp = uData.xp || 0;
        const nextXP = level * 1000;
        const progress = (xp / nextXP) * 100;
        
        document.getElementById('currentLevel').textContent = level;
        document.getElementById('currentXP').textContent = xp;
        document.getElementById('nextLevelXP').textContent = nextXP;
        document.getElementById('levelProgressBar').style.width = `${progress}%`;
        
        // Level Badge from Firebase
        const levelImg = document.getElementById('levelImage');
        if (uData.levelBadgeUrl) {
            levelImg.src = uData.levelBadgeUrl;
            levelImg.style.display = 'block';
        } else {
            levelImg.style.display = 'none';
        }

        lucide.createIcons();
    }

    // Edit Profile Logic
    window.openEditModal = () => {
        document.getElementById('editNameInput').value = uData.name || '';
        document.getElementById('editAvatarInput').value = uData.avatar || '';
        document.getElementById('editProfileModal').classList.add('active');
    };

    window.closeEditModal = () => {
        document.getElementById('editProfileModal').classList.remove('active');
    };

    window.saveProfileChanges = async () => {
        const newName = document.getElementById('editNameInput').value;
        const newAvatar = document.getElementById('editAvatarInput').value;
        
        if (!newName) return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…');

        try {
            const userRef = doc(db, "users", auth.currentUser.uid);
            await updateDoc(userRef, {
                name: newName,
                avatar: newAvatar
            });
            closeEditModal();
        } catch (error) {
            console.error("Error updating profile:", error);
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«');
        }
    };

    window.logout = () => signOut(auth);

</script>
</body>
</html>
