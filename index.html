<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Afnan AI - Elite Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Noto Sans Arabic', sans-serif; }
        body { background-color: #0f172a; color: #f8fafc; transition: all 0.3s ease; }
        .light-mode { background-color: #f1f5f9; color: #0f172a; }

        /* UI Elements */
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 24px; }
        .light-mode .glass-card { background: rgba(255, 255, 255, 0.8); border: 1px solid rgba(0, 0, 0, 0.05); }
        
        .view-screen { display: none; padding: 100px 1rem 120px; min-height: 100vh; }
        .view-screen.active { display: block; animation: fadeIn 0.4s ease-out; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Profile & ID */
        .profile-glow { position: relative; width: 85px; height: 85px; margin: 0 auto; }
        .avatar-main { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 3px solid #f59e0b; padding: 3px; }
        .frame-overlay { position: absolute; inset: -15px; z-index: 10; pointer-events: none; }

        .id-badge { background: linear-gradient(135deg, #f59e0b, #9a3412); padding: 4px 12px; border-radius: 50px; font-weight: 800; font-size: 0.75rem; color: white; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4); }

        /* Navigation */
        .bottom-nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; height: 70px; background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(20px); border-radius: 35px; border: 1px solid rgba(255, 255, 255, 0.1); display: flex; align-items: center; justify-content: space-around; z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; color: #94a3b8; transition: 0.3s; cursor: pointer; }
        .nav-item.active { color: #f59e0b; transform: translateY(-5px); }

        /* Modal */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 5000; display: none; align-items: center; justify-content: center; padding: 1.5rem; }
        .modal.active { display: flex; }
    </style>
</head>
<body>

<!-- Login -->
<div id="loginPage" class="fixed inset-0 bg-slate-900 z-[10000] flex flex-col items-center justify-center p-8">
    <div class="mb-8 relative">
        <div class="absolute inset-0 bg-orange-500 blur-3xl opacity-20 animate-pulse"></div>
        <img src="https://files.manuscdn.com/user_upload_by_module/session_file/310519663174655187/mcieZCLEOIrmCjBq.png" class="w-32 relative">
    </div>
    <h1 class="text-4xl font-black mb-2 text-white">AFNAN <span class="text-orange-500">AI</span></h1>
    <p class="text-slate-400 mb-10 text-center">Ù‚Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¨Ø¯Ø¡ Ø±Ø­Ù„ØªÙƒ</p>
    <button onclick="login()" class="w-full max-w-xs bg-white text-black font-bold py-4 rounded-2xl flex items-center justify-center gap-3 active:scale-95 transition">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-6">
        Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Ø¬ÙˆØ¬Ù„
    </button>
</div>

<!-- Header -->
<header class="fixed top-0 inset-x-0 h-20 flex items-center justify-between px-6 z-50 transition-all" id="mainHeader">
    <div class="flex items-center gap-3">
        <button onclick="openProfileEdit()" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center border border-slate-700">
            <i data-lucide="settings" class="w-5 h-5 text-slate-300"></i>
        </button>
        <span class="font-bold text-lg" id="headerName">...</span>
    </div>
    <div class="flex items-center gap-4">
        <div class="flex items-center gap-2 bg-orange-500/10 px-3 py-1.5 rounded-full border border-orange-500/20">
            <span class="font-bold text-orange-500" id="headerBalance">0</span>
            <span class="text-xs">ğŸ’°</span>
        </div>
        <button onclick="toggleTheme()" class="text-slate-400"><i data-lucide="moon" id="themeIcon"></i></button>
    </div>
</header>

<!-- Main App Content -->
<div id="mainApp" class="hidden">
    <!-- View: Home -->
    <main id="view-home" class="view-screen active">
        <div class="glass-card p-6 mb-6 flex flex-col items-center">
            <div class="profile-glow mb-4">
                <img id="userAvatar" src="" class="avatar-main">
                <img id="activeFrame" src="" class="frame-overlay hidden">
            </div>
            <h2 class="text-2xl font-black mb-1" id="userName">...</h2>
            <div class="id-badge flex items-center gap-2 mb-4" onclick="copyMyID()">
                <span id="userID">00000000</span>
                <i data-lucide="copy" class="w-3 h-3"></i>
            </div>
            
            <div class="w-full space-y-3">
                <div class="flex justify-between text-xs font-bold px-1">
                    <span>Ù…Ø³ØªÙˆÙ‰ <span id="userLevel">1</span></span>
                    <span id="userXP">0 / 1000 XP</span>
                </div>
                <div class="h-2 w-full bg-slate-800 rounded-full overflow-hidden">
                    <div id="xpProgress" class="h-full bg-gradient-to-r from-orange-500 to-yellow-400 transition-all duration-1000" style="width: 0%"></div>
                </div>
            </div>

            <div class="flex gap-2 mt-6 overflow-x-auto w-full py-2" id="userBadges">
                <!-- Badges will be loaded here -->
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="glass-card p-4 text-center">
                <div class="text-2xl mb-1">ğŸ”¥</div>
                <div class="text-xs text-slate-400">Ø³Ø­Ø± Ø§Ù„Ø«Ø±ÙˆØ©</div>
                <div class="font-black text-orange-500" id="wealthPower">0</div>
            </div>
            <div class="glass-card p-4 text-center">
                <div class="text-2xl mb-1">âœ¨</div>
                <div class="text-xs text-slate-400">Ù‚ÙˆØ© Ø§Ù„ØªØ£Ø«ÙŠØ±</div>
                <div class="font-black text-blue-500" id="influencePower">0</div>
            </div>
        </div>
    </main>

    <!-- View: Store -->
    <main id="view-store" class="view-screen">
        <h2 class="text-2xl font-black mb-6 px-2">Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…Ù„ÙƒÙŠ</h2>
        <div class="grid grid-cols-2 gap-4" id="storeGrid">
            <!-- Items from Firestore -->
        </div>
    </main>

    <!-- View: Wallet -->
    <main id="view-wallet" class="view-screen">
        <div class="glass-card p-8 text-center mb-8 bg-gradient-to-br from-orange-500 to-red-600 border-none">
            <div class="text-white/80 text-sm mb-2">Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
            <div class="text-5xl font-black text-white mb-4" id="walletBalance">0</div>
            <button class="bg-white text-orange-600 px-8 py-3 rounded-2xl font-bold shadow-xl">Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</button>
        </div>
        
        <h3 class="font-bold mb-4">Ø´Ø­Ù† Ø§Ù„Ø°Ù‡Ø¨</h3>
        <div class="space-y-3">
            <div onclick="recharge(5000)" class="glass-card p-4 flex justify-between items-center active:bg-orange-500/10">
                <div class="flex items-center gap-3">
                    <span class="text-2xl">ğŸ“¦</span>
                    <div>
                        <div class="font-bold">5,000 Ù‚Ø·Ø¹Ø©</div>
                        <div class="text-xs text-slate-400">Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø¨ØªØ¯Ø¦</div>
                    </div>
                </div>
                <div class="bg-orange-500 px-4 py-1.5 rounded-xl font-bold text-sm">$0.99</div>
            </div>
        </div>
    </main>
</div>

<!-- Navigation Bar -->
<nav class="bottom-nav">
    <div onclick="switchView('home')" class="nav-item active" id="nav-home">
        <i data-lucide="user"></i>
        <span class="text-[10px] font-bold">Ø­Ø³Ø§Ø¨ÙŠ</span>
    </div>
    <div onclick="switchView('store')" class="nav-item" id="nav-store">
        <i data-lucide="shopping-bag"></i>
        <span class="text-[10px] font-bold">Ø§Ù„Ù…ØªØ¬Ø±</span>
    </div>
    <div onclick="switchView('wallet')" class="nav-item" id="nav-wallet">
        <i data-lucide="wallet"></i>
        <span class="text-[10px] font-bold">Ø§Ù„Ù…Ø­ÙØ¸Ø©</span>
    </div>
</nav>

<!-- Modal: Profile Edit -->
<div id="editModal" class="modal">
    <div class="glass-card w-full max-w-md p-6">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„</h3>
            <button onclick="closeModal()"><i data-lucide="x"></i></button>
        </div>
        
        <div class="space-y-4">
            <div>
                <label class="text-xs text-slate-400 mb-1 block">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</label>
                <input type="text" id="editAvatar" class="w-full bg-slate-800 border border-slate-700 p-4 rounded-xl text-sm outline-none focus:border-orange-500" placeholder="Ø¶Ø¹ Ø±Ø§Ø¨Ø· URL Ù„Ù„ØµÙˆØ±Ø©...">
            </div>
            <div>
                <label class="text-xs text-slate-400 mb-1 block">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±</label>
                <input type="text" id="editName" class="w-full bg-slate-800 border border-slate-700 p-4 rounded-xl text-sm outline-none focus:border-orange-500">
            </div>
            <button onclick="saveProfile()" class="w-full bg-orange-500 py-4 rounded-xl font-bold text-white shadow-lg shadow-orange-500/20">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, onSnapshot, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBnmqWRY6lV54meFvO89QeXwtd28w81FcY",
        authDomain: "rtx3090-28439.firebaseapp.com",
        projectId: "rtx3090-28439",
        storageBucket: "rtx3090-28439.firebasestorage.app",
        messagingSenderId: "178612030690",
        appId: "1:178612030690:web:883189ced2ed3a78e3e2bb"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let userData = null;

    // Authentication
    window.login = async () => {
        const provider = new GoogleAuthProvider();
        try {
            const res = await signInWithPopup(auth, provider);
            await checkUser(res.user);
        } catch (err) { console.error(err); }
    };

    async function checkUser(user) {
        const userRef = doc(db, "users", user.uid);
        const snap = await getDoc(userRef);
        
        if (!snap.exists()) {
            const newData = {
                uid: user.uid,
                displayName: user.displayName,
                photoURL: user.photoURL,
                balance: 1500,
                level: 1,
                xp: 0,
                wealth: 0,
                influence: 0,
                customId: Math.floor(10000000 + Math.random() * 90000000).toString(),
                inventory: [],
                activeFrame: null,
                activeBadges: []
            };
            await setDoc(userRef, newData);
        }
    }

    onAuthStateChanged(auth, (user) => {
        if (user) {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // Real-time Sync
            onSnapshot(doc(db, "users", user.uid), (snap) => {
                userData = snap.data();
                updateUI();
            });
            loadStore();
        } else {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }
    });

    function updateUI() {
        if (!userData) return;
        
        // General Info
        document.getElementById('userName').innerText = userData.displayName;
        document.getElementById('headerName').innerText = userData.displayName;
        document.getElementById('userAvatar').src = userData.photoURL;
        document.getElementById('userID').innerText = userData.customId;
        document.getElementById('walletBalance').innerText = userData.balance.toLocaleString();
        document.getElementById('headerBalance').innerText = userData.balance.toLocaleString();
        
        // Stats
        document.getElementById('wealthPower').innerText = userData.wealth;
        document.getElementById('influencePower').innerText = userData.influence;
        document.getElementById('userLevel').innerText = userData.level;
        
        const xpNeeded = userData.level * 1000;
        document.getElementById('userXP').innerText = `${userData.xp} / ${xpNeeded} XP`;
        document.getElementById('xpProgress').style.width = `${(userData.xp / xpNeeded) * 100}%`;

        // Frame
        const frameEl = document.getElementById('activeFrame');
        if (userData.activeFrame) {
            frameEl.src = userData.activeFrame;
            frameEl.classList.remove('hidden');
        } else {
            frameEl.classList.add('hidden');
        }

        // Badges (Real Images from Firestore)
        const badgeContainer = document.getElementById('userBadges');
        badgeContainer.innerHTML = '';
        if (userData.activeBadges) {
            userData.activeBadges.forEach(url => {
                badgeContainer.innerHTML += `<img src="${url}" class="w-10 h-10 object-contain drop-shadow-lg">`;
            });
        }
        
        lucide.createIcons();
    }

    // Store Logic
    async function loadStore() {
        // Here you would fetch from collection "store"
        // For this demo, let's assume we fetch items:
        const storeGrid = document.getElementById('storeGrid');
        storeGrid.innerHTML = `
            <div class="glass-card p-4 flex flex-col items-center">
                <img src="https://i.postimg.cc/qR5mFq2x/frame-gold.png" class="w-20 mb-3">
                <div class="font-bold text-sm">Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø°Ù‡Ø¨ÙŠ</div>
                <div class="text-xs text-slate-400 mb-3">Ø¯Ø§Ø¦Ù…</div>
                <button onclick="buyItem('frame', 'https://i.postimg.cc/qR5mFq2x/frame-gold.png', 5000)" class="w-full bg-slate-800 py-2 rounded-xl text-xs font-bold">5000 ğŸ’°</button>
            </div>
            <div class="glass-card p-4 flex flex-col items-center">
                <img src="https://i.postimg.cc/G296SptC/badge-vip.png" class="w-16 mb-3">
                <div class="font-bold text-sm">Ø´Ø§Ø±Ø© Ø§Ù„Ù€ VIP</div>
                <div class="text-xs text-slate-400 mb-3">Ø¹Ø¶Ùˆ Ù…ØªÙ…ÙŠØ²</div>
                <button onclick="buyItem('badge', 'https://i.postimg.cc/G296SptC/badge-vip.png', 10000)" class="w-full bg-slate-800 py-2 rounded-xl text-xs font-bold">10000 ğŸ’°</button>
            </div>
        `;
    }

    window.buyItem = async (type, url, price) => {
        if (userData.balance < price) return alert("Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ!");
        
        const userRef = doc(db, "users", auth.currentUser.uid);
        let update = { balance: increment(-price) };
        
        if (type === 'frame') update.activeFrame = url;
        if (type === 'badge') {
            const newBadges = userData.activeBadges || [];
            if (!newBadges.includes(url)) newBadges.push(url);
            update.activeBadges = newBadges;
        }
        
        await updateDoc(userRef, update);
        alert("ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
    };

    // Profile Editing
    window.openProfileEdit = () => {
        document.getElementById('editName').value = userData.displayName;
        document.getElementById('editAvatar').value = userData.photoURL;
        document.getElementById('editModal').classList.add('active');
    };

    window.closeModal = () => document.getElementById('editModal').classList.remove('active');

    window.saveProfile = async () => {
        const name = document.getElementById('editName').value;
        const avatar = document.getElementById('editAvatar').value;
        
        if (!name || !avatar) return;
        
        await updateDoc(doc(db, "users", auth.currentUser.uid), {
            displayName: name,
            photoURL: avatar
        });
        closeModal();
    };

    window.copyMyID = () => {
        navigator.clipboard.writeText(userData.customId);
        alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù€ ID Ø¨Ù†Ø¬Ø§Ø­!");
    };

    window.switchView = (view) => {
        document.querySelectorAll('.view-screen').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        
        document.getElementById('view-' + view).classList.add('active');
        document.getElementById('nav-' + view).classList.add('active');
    };

    window.toggleTheme = () => {
        document.body.classList.toggle('light-mode');
        const isLight = document.body.classList.contains('light-mode');
        document.getElementById('themeIcon').setAttribute('data-lucide', isLight ? 'sun' : 'moon');
        lucide.createIcons();
    };

    window.recharge = async (amt) => {
        await updateDoc(doc(db, "users", auth.currentUser.uid), {
            balance: increment(amt),
            wealth: increment(Math.floor(amt / 100))
        });
        alert(`ØªÙ… Ø´Ø­Ù† ${amt} Ø°Ù‡Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­!`);
    };

    lucide.createIcons();
</script>
</body>
</html>

