<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Afnan AI - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Noto Sans Arabic', sans-serif; }
        body, html { height: 100%; margin: 0; background-color: #f8f9fa; color: #1a1a1a; overflow-x: hidden; }
        
        .view-screen { position: absolute; inset: 0; width: 100%; height: 100%; background: #f8f9fa; display: none; flex-direction: column; z-index: 10; padding-top: 70px; overflow-y: auto; }
        .view-screen.active { display: flex; }

        .app-header { position: fixed; top: 0; right: 0; left: 0; height: 70px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); border-bottom: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; padding: 0 1rem; z-index: 1000; }

        /* Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± */
        .profile-container { position: relative; width: 100px; height: 100px; margin: 0 auto; }
        .avatar-img { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; position: absolute; top: 10px; left: 10px; z-index: 1; }
        .user-frame { position: absolute; inset: 0; z-index: 2; width: 100%; height: 100%; pointer-events: none; }
        
        .level-badge { font-size: 10px; font-weight: 800; padding: 2px 8px; border-radius: 10px; color: white; margin: 2px; }
        .wealth-lv { background: linear-gradient(to left, #f59e0b, #d97706); }
        .magic-lv { background: linear-gradient(to left, #8b5cf6, #6d28d9); }
        .recharge-lv { background: linear-gradient(to left, #10b981, #059669); }

        .badges-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; padding: 10px; width: 100%; max-width: 200px; margin: 0 auto; }
        .badge-slot { width: 40px; height: 40px; background: #f3f4f6; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; border: 1px dashed #ccc; }
        .badge-slot.has-badge { border: 2px solid #f59e0b; background: linear-gradient(135deg, #fff5e6, #ffedd5); }

        /* ØªØµÙ…ÙŠÙ… ÙƒØ±Øª Ø§Ù„Ù…Ø­ÙØ¸Ø© */
        .wallet-card { background: linear-gradient(135deg, #1e293b, #0f172a); color: white; border-radius: 30px; padding: 30px; margin: 20px; position: relative; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .wallet-card::after { content: ''; position: absolute; top: -50%; right: -50%; width: 200px; height: 200px; background: rgba(245, 158, 11, 0.1); border-radius: 50%; }

        .buy-card { background: white; border: 1px solid #eee; border-radius: 20px; padding: 15px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; transition: 0.2s; }
        .buy-card:active { transform: scale(0.98); border-color: #f59e0b; }

        .sidebar { position: fixed; top: 0; right: -300px; width: 300px; height: 100%; background: white; z-index: 4000; transition: 0.4s; border-left: 1px solid #eee; }
        .sidebar.open { right: 0; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.3); z-index: 2500; display: none; backdrop-filter: blur(4px); }
        .overlay.active { display: block; }

        /* Ø§Ù„Ø¨Ø­Ø« */
        .search-container { position: fixed; top: 70px; right: 0; left: 0; background: white; padding: 1rem; border-bottom: 1px solid #eee; z-index: 999; display: none; }
        .search-container.active { display: block; }
        .search-input { width: 100%; padding: 12px 16px; border: 2px solid #f3f4f6; border-radius: 12px; font-size: 14px; background: #fafafa; }

        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ØªØ¬Ø± */
        .store-item { background: white; border-radius: 16px; padding: 16px; text-align: center; border: 1px solid #eee; transition: 0.2s; }
        .store-item:active { transform: scale(0.98); }
        .store-item.owned { opacity: 0.6; }
        .store-item.equipped { border: 2px solid #10b981; }
        
        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #f59e0b; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Ø§Ù„Ø¨Ù†Ø± */
        .banner-container { margin: 0 20px 20px; border-radius: 20px; overflow: hidden; height: 80px; }
        .banner-link { display: block; width: 100%; height: 100%; }
        .banner-image { width: 100%; height: 100%; object-fit: cover; }
        
        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        .admin-panel { max-width: 800px; margin: 0 auto; padding: 20px; }
        .admin-form { background: white; border-radius: 20px; padding: 20px; margin-bottom: 20px; border: 1px solid #eee; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; font-size: 12px; font-weight: 600; margin-bottom: 5px; color: #666; }
        .form-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 14px; }
        .form-textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 14px; min-height: 100px; resize: vertical; }
        
        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± */
        .items-list { background: white; border-radius: 20px; padding: 20px; border: 1px solid #eee; }
        .item-row { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #f3f4f6; }
        .item-row:last-child { border-bottom: none; }
        .item-image { width: 50px; height: 50px; object-fit: cover; border-radius: 10px; margin-left: 15px; }
        .item-info { flex: 1; }
        .item-name { font-weight: bold; font-size: 14px; }
        .item-meta { font-size: 12px; color: #666; }
        .item-actions { display: flex; gap: 10px; }
        
        /* ID Ù…Ø¹ Ø®Ù„ÙÙŠØ© */
        .id-badge { position: relative; display: inline-flex; align-items: center; padding: 5px 15px; border-radius: 20px; color: white; font-weight: bold; font-size: 12px; background-size: cover; background-position: center; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
        .copy-btn { margin-right: 8px; background: rgba(255,255,255,0.2); border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        
        /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ */
        .edit-profile-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 5000; display: none; align-items: center; justify-content: center; }
        .edit-profile-modal.active { display: flex; }
        .edit-profile-content { background: white; width: 90%; max-width: 400px; border-radius: 20px; padding: 25px; }
        
        /* Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .tab-btn { padding: 10px 20px; border-radius: 10px; font-size: 13px; font-weight: 600; background: #f3f4f6; border: none; cursor: pointer; }
        .tab-btn.active { background: #f59e0b; color: white; }
    </style>
</head>
<body>

    <div id="toastContainer" class="fixed bottom-5 left-1/2 -translate-x-1/2 z-[11000]"></div>

    <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginPage" class="fixed inset-0 bg-white z-[10000] flex flex-col items-center justify-center p-6">
        <img src="https://files.manuscdn.com/user_upload_by_module/session_file/310519663174655187/mcieZCLEOIrmCjBq.png" class="w-24 mb-6">
        
        <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ -->
        <div id="userLoginSection">
            <button onclick="loginWithGoogle()" class="w-full max-w-xs flex items-center justify-center gap-3 border p-4 rounded-2xl font-bold shadow-sm hover:bg-gray-50 mb-4">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-5">
                Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Ø¬ÙˆØ¬Ù„
            </button>
            <button onclick="switchToAdminLogin()" class="text-sm text-blue-500 hover:text-blue-700">
                Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³Ø¤ÙˆÙ„
            </button>
        </div>
        
        <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ -->
        <div id="adminLoginSection" class="hidden w-full max-w-xs">
            <h3 class="text-lg font-bold mb-4">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h3>
            <input type="email" id="adminEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="form-input mb-3">
            <input type="password" id="adminPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="form-input mb-4">
            <button onclick="adminLogin()" class="w-full bg-gray-800 text-white p-4 rounded-2xl font-bold">Ø¯Ø®ÙˆÙ„</button>
            <button onclick="switchToUserLogin()" class="w-full text-sm text-gray-500 mt-3">
                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            </button>
        </div>
        
        <div id="loginError" class="mt-4 text-red-500 text-sm hidden"></div>
        <div id="loginLoading" class="mt-4 hidden">
            <div class="loading"></div>
            <span class="text-gray-600 text-sm mr-2">Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...</span>
        </div>
    </div>

    <!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div id="main-app" style="display: none;">
        <header class="app-header">
            <button onclick="toggleSidebar()" class="p-2 bg-gray-50 rounded-lg"><i data-lucide="menu"></i></button>
            <div class="font-bold" id="view-title">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
            <div class="flex items-center gap-2">
                <button onclick="toggleSearch()" class="p-2 bg-gray-50 rounded-lg"><i data-lucide="search"></i></button>
                <div class="flex items-center gap-2 bg-orange-50 px-3 py-1 rounded-full cursor-pointer" onclick="switchView('wallet')">
                    <span id="header-balance" class="text-xs font-bold text-orange-600">0</span>
                    <span>ğŸ’°</span>
                </div>
            </div>
        </header>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
        <div id="searchContainer" class="search-container">
            <div class="flex gap-2">
                <input type="text" id="searchInput" class="search-input flex-1" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø±Ù‚Ù… ID...">
                <button onclick="searchUsers()" class="bg-orange-500 text-white px-4 rounded-xl font-bold text-sm">Ø¨Ø­Ø«</button>
            </div>
            <div id="searchResults" class="mt-3 max-h-60 overflow-y-auto"></div>
        </div>

        <!-- Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± -->
        <div id="sidebar" class="sidebar overflow-y-auto">
            <div class="p-6 text-center border-b">
                <div class="profile-container">
                    <img id="userAvatar" src="https://i.pravatar.cc/150" class="avatar-img">
                    <img id="activeFrame" src="" class="user-frame" style="display: none;">
                </div>
                <div id="userName" class="font-bold mt-2 text-gray-800">ØªØ­Ù…ÙŠÙ„...</div>
                <div id="userEmail" class="text-xs text-gray-500 mb-1"></div>
                
                <!-- ID Ù…Ø¹ Ø²Ø± Ø§Ù„Ù†Ø³Ø® -->
                <div class="my-3 relative">
                    <div class="id-badge" id="userIDBadge">
                        <div class="copy-btn" onclick="copyUserId()">
                            <i data-lucide="copy" class="w-3 h-3"></i>
                        </div>
                        <span id="userID">88291034</span>
                    </div>
                    <button onclick="openEditProfile()" class="absolute left-0 top-1/2 -translate-y-1/2 p-1 bg-gray-100 rounded-lg">
                        <i data-lucide="edit-2" class="w-3 h-3"></i>
                    </button>
                </div>
                
                <div class="flex justify-center gap-1 my-2">
                    <span id="wealth-lv" class="level-badge wealth-lv">Ø«Ø±ÙˆØ© LV 1</span>
                    <span id="magic-lv" class="level-badge magic-lv">Ø³Ø­Ø± LV 1</span>
                    <span id="recharge-lv" class="level-badge recharge-lv">Ø´Ø­Ù† LV 1</span>
                </div>
                
                <div class="badges-grid" id="userBadges">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
            
            <div class="p-4">
                <div class="flex items-center gap-4 p-4 hover:bg-gray-50 rounded-xl cursor-pointer" onclick="switchView('rooms')">
                    <i data-lucide="home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </div>
                <div class="flex items-center gap-4 p-4 hover:bg-gray-50 rounded-xl cursor-pointer" onclick="switchView('wallet')">
                    <i data-lucide="wallet"></i> Ø§Ù„Ù…Ø­ÙØ¸Ø©
                </div>
                <div class="flex items-center gap-4 p-4 hover:bg-gray-50 rounded-xl cursor-pointer" onclick="switchView('store')">
                    <i data-lucide="shopping-bag"></i> Ø§Ù„Ù…ØªØ¬Ø±
                </div>
                <div id="adminPanelBtn" class="flex items-center gap-4 p-4 hover:bg-gray-50 rounded-xl cursor-pointer hidden" onclick="switchView('admin')">
                    <i data-lucide="shield"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </div>
                <div class="flex items-center gap-4 p-4 hover:bg-gray-50 rounded-xl cursor-pointer text-red-500" onclick="logout()">
                    <i data-lucide="log-out"></i> Ø®Ø±ÙˆØ¬
                </div>
            </div>
        </div>

        <!-- ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ -->
        <div id="editProfileModal" class="edit-profile-modal">
            <div class="edit-profile-content">
                <h3 class="font-bold text-lg mb-4">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h3>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø§Ø³Ù…</label>
                    <input type="text" id="editUserName" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
                </div>
                <div class="form-group">
                    <label class="form-label">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label>
                    <input type="text" id="editUserAvatar" class="form-input" placeholder="https://example.com/avatar.jpg">
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ù€ ID Ø§Ù„Ù…Ù…ÙŠØ²</label>
                    <input type="text" id="editUserId" class="form-input" placeholder="Ø±Ù‚Ù… ID Ù…Ù…ÙŠØ²">
                </div>
                <div class="form-group">
                    <label class="form-label">Ø®Ù„ÙÙŠØ© Ø§Ù„Ù€ ID</label>
                    <input type="text" id="editIdBackground" class="form-input" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©">
                </div>
                <div class="flex gap-3 mt-6">
                    <button onclick="saveProfile()" class="flex-1 bg-green-500 text-white py-3 rounded-xl font-bold">Ø­ÙØ¸</button>
                    <button onclick="closeEditProfile()" class="flex-1 bg-gray-200 py-3 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>
        </div>

        <!-- Ø¹Ø±Ø¶ Ø§Ù„ØºØ±Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div id="view-rooms" class="view-screen active">
            <!-- Ø§Ù„Ø¨Ù†Ø± -->
            <div id="bannerContainer" class="banner-container">
                <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù†Ø±Ø§Øª Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
            
            <!-- Ø§Ù„ØºØ±Ù -->
            <div class="p-4 grid grid-cols-2 gap-4" id="roomsContainer"></div>
        </div>

        <!-- Ø§Ù„Ù…Ø­ÙØ¸Ø© -->
        <div id="view-wallet" class="view-screen">
            <div class="wallet-card">
                <div class="text-[10px] uppercase tracking-widest text-gray-400 font-bold mb-2">Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                <div class="flex items-baseline gap-2">
                    <span id="wallet-balance-big" class="text-4xl font-bold">0</span>
                    <span class="text-orange-500 font-bold">ğŸ’°</span>
                </div>
            </div>

            <div class="px-5">
                <h3 class="font-bold text-gray-800 mb-4 px-2">Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø´Ø­Ù†</h3>
                
                <div class="buy-card">
                    <div>
                        <div class="font-bold text-gray-800">Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø¨ØªØ¯Ø¦</div>
                        <div class="text-[11px] text-orange-500 font-bold">+27,000 Ø¹Ù…Ù„Ø©</div>
                    </div>
                    <button onclick="recharge(27000, 1)" class="bg-orange-500 text-white px-6 py-2 rounded-xl font-bold text-sm shadow-lg shadow-orange-100">1$ Ø´Ø±Ø§Ø¡</button>
                </div>

                <div class="buy-card">
                    <div>
                        <div class="font-bold text-gray-800">Ø¨Ø§Ù‚Ø© Ø§Ù„Ù†Ø®Ø¨Ø©</div>
                        <div class="text-[11px] text-orange-500 font-bold">+150,000 Ø¹Ù…Ù„Ø©</div>
                    </div>
                    <button onclick="recharge(150000, 5)" class="bg-gray-800 text-white px-6 py-2 rounded-xl font-bold text-sm">5$ Ø´Ø±Ø§Ø¡</button>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ù…ØªØ¬Ø± -->
        <div id="view-store" class="view-screen">
            <div class="flex justify-center gap-2 p-4">
                <button id="framesBtn" class="px-4 py-2 bg-orange-500 text-white rounded-xl text-xs font-bold" onclick="filterStore('frames')">Ø¥Ø·Ø§Ø±Ø§Øª</button>
                <button id="badgesBtn" class="px-4 py-2 bg-gray-100 rounded-xl text-xs font-bold" onclick="filterStore('badges')">Ø´Ø§Ø±Ø§Øª</button>
            </div>
            <div id="storeItems" class="grid grid-cols-2 gap-4 p-4"></div>
        </div>

        <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
        <div id="view-admin" class="view-screen">
            <div class="admin-panel">
                <h2 class="text-2xl font-bold mb-6">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h2>
                
                <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
                <div class="tabs">
                    <button class="tab-btn active" onclick="showAdminTab('banners')">Ø§Ù„Ø¨Ù†Ø±Ø§Øª</button>
                    <button class="tab-btn" onclick="showAdminTab('frames')">Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª</button>
                    <button class="tab-btn" onclick="showAdminTab('badges')">Ø§Ù„Ø´Ø§Ø±Ø§Øª</button>
                    <button class="tab-btn" onclick="showAdminTab('levels')">Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</button>
                    <button class="tab-btn" onclick="showAdminTab('users')">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
                </div>
                
                <!-- Ø§Ù„Ø¨Ù†Ø±Ø§Øª -->
                <div id="adminBannersTab" class="admin-tab">
                    <div class="admin-form">
                        <h3 class="font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø± Ø¬Ø¯ÙŠØ¯</h3>
                        <div class="form-group">
                            <label class="form-label">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label>
                            <input type="text" id="bannerImageUrl" class="form-input" placeholder="https://example.com/banner.jpg">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø±Ø§Ø¨Ø· Ø§Ù„ØªÙˆØ¬ÙŠÙ‡</label>
                            <input type="text" id="bannerLink" class="form-input" placeholder="https://example.com">
                        </div>
                        <button onclick="addBanner()" class="w-full bg-green-500 text-white py-3 rounded-xl font-bold">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù†Ø±</button>
                    </div>
                    
                    <div class="items-list">
                        <h3 class="font-bold mb-4">Ø§Ù„Ø¨Ù†Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
                        <div id="bannersList"></div>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª -->
                <div id="adminFramesTab" class="admin-tab" style="display: none;">
                    <div class="admin-form">
                        <h3 class="font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ø¥Ø·Ø§Ø± Ø¬Ø¯ÙŠØ¯</h3>
                        <div class="form-group">
                            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¥Ø·Ø§Ø±</label>
                            <input type="text" id="frameName" class="form-input" placeholder="Ø¥Ø·Ø§Ø± Ø°Ù‡Ø¨ÙŠ">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø³Ø¹Ø±</label>
                            <input type="number" id="framePrice" class="form-input" placeholder="5000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label>
                            <input type="text" id="frameImage" class="form-input" placeholder="https://example.com/frame.png">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ÙˆØµÙ</label>
                            <textarea id="frameDescription" class="form-textarea" placeholder="ÙˆØµÙ Ø§Ù„Ø¥Ø·Ø§Ø±"></textarea>
                        </div>
                        <button onclick="addFrame()" class="w-full bg-green-500 text-white py-3 rounded-xl font-bold">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø·Ø§Ø±</button>
                    </div>
                    
                    <div class="items-list">
                        <h3 class="font-bold mb-4">Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
                        <div id="framesList"></div>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø´Ø§Ø±Ø§Øª -->
                <div id="adminBadgesTab" class="admin-tab" style="display: none;">
                    <div class="admin-form">
                        <h3 class="font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ø´Ø§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                        <div class="form-group">
                            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø©</label>
                            <input type="text" id="badgeName" class="form-input" placeholder="Ø´Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ùƒ">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø³Ø¹Ø±</label>
                            <input type="number" id="badgePrice" class="form-input" placeholder="1000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©</label>
                            <input type="text" id="badgeIcon" class="form-input" placeholder="ğŸ‘‘">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ÙˆØµÙ</label>
                            <textarea id="badgeDescription" class="form-textarea" placeholder="ÙˆØµÙ Ø§Ù„Ø´Ø§Ø±Ø©"></textarea>
                        </div>
                        <button onclick="addBadge()" class="w-full bg-green-500 text-white py-3 rounded-xl font-bold">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø§Ø±Ø©</button>
                    </div>
                    
                    <div class="items-list">
                        <h3 class="font-bold mb-4">Ø§Ù„Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
                        <div id="badgesList"></div>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª -->
                <div id="adminLevelsTab" class="admin-tab" style="display: none;">
                    <div class="admin-form">
                        <h3 class="font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯</h3>
                        <div class="form-group">
                            <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
                            <select id="levelType" class="form-input">
                                <option value="wealth">Ø«Ø±ÙˆØ©</option>
                                <option value="magic">Ø³Ø­Ø±</option>
                                <option value="recharge">Ø´Ø­Ù†</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
                            <input type="number" id="levelNumber" class="form-input" placeholder="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</label>
                            <input type="number" id="levelRequired" class="form-input" placeholder="1000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
                            <input type="text" id="levelImage" class="form-input" placeholder="https://example.com/level.png">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø§Ø³Ù…</label>
                            <input type="text" id="levelName" class="form-input" placeholder="Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø°Ù‡Ø¨ÙŠ">
                        </div>
                        <button onclick="addLevel()" class="w-full bg-green-500 text-white py-3 rounded-xl font-bold">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰</button>
                    </div>
                    
                    <div class="items-list">
                        <h3 class="font-bold mb-4">Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
                        <div id="levelsList"></div>
                    </div>
                </div>
                
                <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
                <div id="adminUsersTab" class="admin-tab" style="display: none;">
                    <div class="items-list">
                        <h3 class="font-bold mb-4">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
                        <div id="usersList"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="overlay" class="overlay" onclick="toggleSidebar()"></div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            signInWithPopup, 
            GoogleAuthProvider, 
            onAuthStateChanged, 
            signOut,
            signInWithEmailAndPassword 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            getDoc, 
            updateDoc, 
            collection, 
            query, 
            where, 
            getDocs,
            deleteDoc,
            increment,
            serverTimestamp,
            orderBy
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBnmqWRY6lV54meFvO89QeXwtd28w81FcY",
            authDomain: "rtx3090-28439.firebaseapp.com",
            projectId: "rtx3090-28439",
            storageBucket: "rtx3090-28439.firebasestorage.app",
            messagingSenderId: "178612030690",
            appId: "1:178612030690:web:883189ced2ed3a78e3e2bb"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        window.currentUserData = null;
        window.isAdmin = false;
        const ADMIN_EMAIL = "html55551@gmail.com";
        const ADMIN_PASSWORD = "221369";

        // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØ¬Ø±
        window.storeItems = {
            frames: [],
            badges: []
        };

        window.levelsData = {
            wealth: [],
            magic: [],
            recharge: []
        };

        // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        window.showToast = function(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            let bgColor = 'bg-gray-900';
            if (type === 'success') bgColor = 'bg-green-600';
            if (type === 'error') bgColor = 'bg-red-600';
            if (type === 'warning') bgColor = 'bg-orange-500';
            
            toast.className = `${bgColor} text-white px-6 py-3 rounded-2xl text-xs font-bold mb-2 shadow-2xl animate-bounce`;
            toast.innerText = message;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        };

        // ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ù…Ø³Ø¤ÙˆÙ„
        window.switchToAdminLogin = function() {
            document.getElementById('userLoginSection').style.display = 'none';
            document.getElementById('adminLoginSection').classList.remove('hidden');
        };

        window.switchToUserLogin = function() {
            document.getElementById('adminLoginSection').classList.add('hidden');
            document.getElementById('userLoginSection').style.display = 'block';
        };

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³Ø¤ÙˆÙ„
        window.adminLogin = async function() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            
            if (email !== ADMIN_EMAIL || password !== ADMIN_PASSWORD) {
                showToast("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©", 'error');
                return;
            }
            
            try {
                // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨ÙØ§ÙŠØ±Ø¨ÙŠØ²
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                window.isAdmin = true;
                showToast("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ Ù…Ø³Ø¤ÙˆÙ„!", 'success');
                
                // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
                await loadUserData(userCredential.user.uid);
                
            } catch (error) {
                // Ø¥Ø°Ø§ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ØŒ Ù†Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø¤ÙˆÙ„
                console.log("Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø¤ÙˆÙ„ Ø¬Ø¯ÙŠØ¯...");
                await createAdminAccount(email, password);
            }
        };

        async function createAdminAccount(email, password) {
            // ÙÙŠ Ø¨ÙŠØ¦Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ØŒ ÙŠØ¬Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¯ÙˆÙŠØ§Ù‹ ÙÙŠ ÙˆØ­Ø¯Ø© ØªØ­ÙƒÙ… Firebase
            // Ù‡Ù†Ø§ Ø³Ù†Ø³ØªØ®Ø¯Ù… Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„
            window.isAdmin = true;
            showToast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³Ø¤ÙˆÙ„", 'success');
            
            // Ø¥Ø®ÙØ§Ø¡ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            document.getElementById('adminPanelBtn').classList.remove('hidden');
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
            await loadInitialData();
            initApp();
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ
        window.loginWithGoogle = async function() {
            try {
                document.getElementById('loginLoading').classList.remove('hidden');
                document.getElementById('loginError').classList.add('hidden');
                
                const provider = new GoogleAuthProvider();
                provider.addScope('email');
                provider.addScope('profile');
                
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                
                showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.displayName}!`, 'success');
                await initUserData(user);
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:", error);
                document.getElementById('loginError').innerText = `Ø®Ø·Ø£: ${error.message}`;
                document.getElementById('loginError').classList.remove('hidden');
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„", 'error');
            } finally {
                document.getElementById('loginLoading').classList.add('hidden');
            }
        };

        // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        async function initUserData(user) {
            try {
                const userRef = doc(db, "users", user.uid);
                const userSnap = await getDoc(userRef);
                
                if (!userSnap.exists()) {
                    const userData = {
                        uid: user.uid,
                        displayName: user.displayName || 'Ù…Ø³ØªØ®Ø¯Ù…',
                        email: user.email || '',
                        photoURL: user.photoURL || 'https://i.pravatar.cc/150',
                        customId: generateCustomId(),
                        idBackground: 'https://images.unsplash.com/photo-1614850523060-8da1d56ae167?q=80&w=1000',
                        balance: 1000,
                        wealthLv: 1,
                        magicLv: 1,
                        rechargeLv: 1,
                        totalSpent: 0,
                        totalRecharged: 0,
                        purchasedFrames: [],
                        purchasedBadges: [],
                        activeFrame: null,
                        activeBadges: [],
                        createdAt: serverTimestamp(),
                        lastLogin: serverTimestamp(),
                        isAdmin: user.email === ADMIN_EMAIL
                    };
                    
                    await setDoc(userRef, userData);
                    showToast("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰", 'success');
                } else {
                    await updateDoc(userRef, {
                        lastLogin: serverTimestamp()
                    });
                }
                
                await loadUserData(user.uid);
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:", error);
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", 'error');
            }
        }

        // ØªÙˆÙ„ÙŠØ¯ ID Ù…Ø®ØµØµ
        function generateCustomId() {
            return Math.floor(10000000 + Math.random() * 90000000).toString();
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        async function loadUserData(uid) {
            try {
                const userRef = doc(db, "users", uid);
                const userSnap = await getDoc(userRef);
                
                if (userSnap.exists()) {
                    window.currentUserData = userSnap.data();
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³Ø¤ÙˆÙ„Ø§Ù‹
                    if (window.currentUserData.email === ADMIN_EMAIL) {
                        window.isAdmin = true;
                        document.getElementById('adminPanelBtn').classList.remove('hidden');
                    }
                    
                    updateUI(window.currentUserData);
                    
                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
                    await loadInitialData();
                    initApp();
                }
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:", error);
                showToast("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", 'error');
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
        async function loadInitialData() {
            try {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù†Ø±Ø§Øª
                await loadBanners();
                
                // ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ØªØ¬Ø±
                await loadStoreItems();
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª
                await loadLevels();
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³Ø¤ÙˆÙ„Ø§Ù‹ØŒ ØªØ­Ù…ÙŠÙ„ Ù‚ÙˆØ§Ø¦Ù… Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                if (window.isAdmin) {
                    await loadAdminLists();
                }
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©:", error);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù†Ø±Ø§Øª
        async function loadBanners() {
            try {
                const bannersRef = collection(db, "banners");
                const querySnapshot = await getDocs(bannersRef);
                const banners = [];
                
                querySnapshot.forEach(doc => {
                    banners.push({ id: doc.id, ...doc.data() });
                });
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ù†Ø±Ø§Øª
                displayBanners(banners);
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù†Ø±Ø§Øª:", error);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ØªØ¬Ø±
        async function loadStoreItems() {
            try {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª
                const framesRef = collection(db, "frames");
                const framesSnapshot = await getDocs(framesRef);
                window.storeItems.frames = [];
                
                framesSnapshot.forEach(doc => {
                    window.storeItems.frames.push({ id: doc.id, ...doc.data() });
                });
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø§Ø±Ø§Øª
                const badgesRef = collection(db, "badges");
                const badgesSnapshot = await getDocs(badgesRef);
                window.storeItems.badges = [];
                
                badgesSnapshot.forEach(doc => {
                    window.storeItems.badges.push({ id: doc.id, ...doc.data() });
                });
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ØªØ¬Ø±:", error);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª
        async function loadLevels() {
            try {
                const levelsRef = collection(db, "levels");
                const querySnapshot = await getDocs(query(levelsRef, orderBy("levelNumber")));
                
                window.levelsData.wealth = [];
                window.levelsData.magic = [];
                window.levelsData.recharge = [];
                
                querySnapshot.forEach(doc => {
                    const level = { id: doc.id, ...doc.data() };
                    if (level.type === 'wealth') window.levelsData.wealth.push(level);
                    if (level.type === 'magic') window.levelsData.magic.push(level);
                    if (level.type === 'recharge') window.levelsData.recharge.push(level);
                });
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª:", error);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ù‚ÙˆØ§Ø¦Ù… Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        async function loadAdminLists() {
            await loadBannersList();
            await loadFramesList();
            await loadBadgesList();
            await loadLevelsList();
            await loadUsersList();
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        window.logout = async function() {
            try {
                await signOut(auth);
                window.isAdmin = false;
                window.currentUserData = null;
                showToast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­", 'info');
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:", error);
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬", 'error');
            }
        };

        // Ù…ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                await loadUserData(user.uid);
            } else {
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('main-app').style.display = 'none';
                window.isAdmin = false;
            }
        });

        // ÙˆØ¸Ø§Ø¦Ù Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        window.addBanner = async function() {
            try {
                const imageUrl = document.getElementById('bannerImageUrl').value;
                const link = document.getElementById('bannerLink').value;
                
                if (!imageUrl || !link) {
                    showToast("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„", 'error');
                    return;
                }
                
                const bannersRef = collection(db, "banners");
                await addDoc(bannersRef, {
                    imageUrl,
                    link,
                    createdAt: serverTimestamp(),
                    active: true
                });
                
                showToast("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù†Ø± Ø¨Ù†Ø¬Ø§Ø­", 'success');
                document.getElementById('bannerImageUrl').value = '';
                document.getElementById('bannerLink').value = '';
                
                await loadBanners();
                await loadBannersList();
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù†Ø±:", error);
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù†Ø±", 'error');
            }
        };

        window.deleteBanner = async function(bannerId) {
            try {
                if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù†Ø±ØŸ")) return;
                
                await deleteDoc(doc(db, "banners", bannerId));
                showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨Ù†Ø± Ø¨Ù†Ø¬Ø§Ø­", 'success');
                
                await loadBanners();
                await loadBannersList();
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨Ù†Ø±:", error);
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨Ù†Ø±", 'error');
            }
        };

        window.addFrame = async function() {
            try {
                const frameData = {
                    name: document.getElementById('frameName').value,
                    price: parseInt(document.getElementById('framePrice').value),
                    image: document.getElementById('frameImage').value,
                    description: document.getElementById('frameDescription').value,
                    type: 'frame',
                    createdAt: serverTimestamp()
                };
                
                if (!frameData.name || !frameData.price || !frameData.image) {
                    showToast("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©", 'error');
                    return;
                }
                
                const framesRef = collection(db, "frames");
                await addDoc(framesRef, frameData);
                
                showToast("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø·Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­", 'success');
                resetFrameForm();
                
                await loadStoreItems();
                await loadFramesList();
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø·Ø§Ø±:", error);
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø·Ø§Ø±", 'error');
            }
        };

        window.deleteFrame = async function(frameId) {
            try {
                if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø·Ø§Ø±ØŸ")) return;
                
                await deleteDoc(doc(db, "frames", frameId));
                showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø·Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­", 'success');
                
                await loadStoreItems();
                await loadFramesList();
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¥Ø·Ø§Ø±:", error);
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¥Ø·Ø§Ø±", 'error');
            }
        };

        window.addBadge = async function() {
            try {
                const badgeData = {
                    name: document.getElementById('badgeName').value,
                    price: parseInt(document.getElementById('badgePrice').value),
                    icon: document.getElementById('badgeIcon').value,
                    description: document.getElementById('badgeDescription').value,
                    type: 'badge',
                    createdAt: serverTimestamp()
                };
                
                if (!badgeData.name || !badgeData.price || !badgeData.icon) {
                    showToast("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©", 'error');
                    return;
                }
                
                const badgesRef = collection(db, "badges");
                await addDoc(badgesRef, badgeData);
                
                showToast("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø§Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­", 'success');
                resetBadgeForm();
                
                await loadStoreItems();
                await loadBadgesList();
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø§Ø±Ø©:", error);
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø§Ø±Ø©", 'error');
            }
        };

        window.deleteBadge = async function(badgeId) {
            try {
                if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø§Ø±Ø©ØŸ")) return;
                
                await deleteDoc(doc(db, "badges", badgeId));
                showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø´Ø§Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­", 'success');
                
                await loadStoreItems();
                await loadBadgesList();
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø´Ø§Ø±Ø©:", error);
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø´Ø§Ø±Ø©", 'error');
            }
        };

        window.addLevel = async function() {
            try {
                const levelData = {
                    type: document.getElementById('levelType').value,
                    levelNumber: parseInt(document.getElementById('levelNumber').value),
                    required: parseInt(document.getElementById('levelRequired').value),
                    image: document.getElementById('levelImage').value,
                    name: document.getElementById('levelName').value,
                    createdAt: serverTimestamp()
                };
                
                if (!levelData.type || !levelData.levelNumber || !levelData.required) {
                    showToast("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©", 'error');
                    return;
                }
                
                const levelsRef = collection(db, "levels");
                await addDoc(levelsRef, levelData);
                
                showToast("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­", 'success');
                resetLevelForm();
                
                await loadLevels();
                await loadLevelsList();
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰:", error);
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰", 'error');
            }
        };

        window.deleteLevel = async function(levelId) {
            try {
                if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ØŸ")) return;
                
                await deleteDoc(doc(db, "levels", levelId));
                showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­", 'success');
                
                await loadLevels();
                await loadLevelsList();
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªÙˆÙ‰:", error);
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªÙˆÙ‰", 'error');
            }
        };

        // ÙˆØ¸Ø§Ø¦Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
        async function loadBannersList() {
            try {
                const bannersRef = collection(db, "banners");
                const querySnapshot = await getDocs(query(bannersRef, orderBy("createdAt", "desc")));
                const container = document.getElementById('bannersList');
                container.innerHTML = '';
                
                querySnapshot.forEach(doc => {
                    const banner = doc.data();
                    container.innerHTML += `
                        <div class="item-row">
                            <img src="${banner.imageUrl}" class="item-image" onerror="this.src='https://via.placeholder.com/150'">
                            <div class="item-info">
                                <div class="item-name">${banner.link}</div>
                                <div class="item-meta">${new Date(banner.createdAt?.toDate()).toLocaleDateString('ar-SA')}</div>
                            </div>
                            <div class="item-actions">
                                <button onclick="deleteBanner('${doc.id}')" class="px-3 py-1 bg-red-500 text-white text-xs rounded-lg">Ø­Ø°Ù</button>
                            </div>
                        </div>
                    `;
                });
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ù†Ø±Ø§Øª:", error);
            }
        }

        async function loadFramesList() {
            try {
                const framesRef = collection(db, "frames");
                const querySnapshot = await getDocs(query(framesRef, orderBy("createdAt", "desc")));
                const container = document.getElementById('framesList');
                container.innerHTML = '';
                
                querySnapshot.forEach(doc => {
                    const frame = doc.data();
                    container.innerHTML += `
                        <div class="item-row">
                            <img src="${frame.image}" class="item-image" onerror="this.src='https://via.placeholder.com/150'">
                            <div class="item-info">
                                <div class="item-name">${frame.name}</div>
                                <div class="item-meta">Ø§Ù„Ø³Ø¹Ø±: ${frame.price.toLocaleString()} | ${frame.description}</div>
                            </div>
                            <div class="item-actions">
                                <button onclick="deleteFrame('${doc.id}')" class="px-3 py-1 bg-red-500 text-white text-xs rounded-lg">Ø­Ø°Ù</button>
                            </div>
                        </div>
                    `;
                });
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª:", error);
            }
        }

        async function loadBadgesList() {
            try {
                const badgesRef = collection(db, "badges");
                const querySnapshot = await getDocs(query(badgesRef, orderBy("createdAt", "desc")));
                const container = document.getElementById('badgesList');
                container.innerHTML = '';
                
                querySnapshot.forEach(doc => {
                    const badge = doc.data();
                    container.innerHTML += `
                        <div class="item-row">
                            <div class="item-image flex items-center justify-center bg-gray-100 text-2xl">
                                ${badge.icon}
                            </div>
                            <div class="item-info">
                                <div class="item-name">${badge.name}</div>
                                <div class="item-meta">Ø§Ù„Ø³Ø¹Ø±: ${badge.price.toLocaleString()} | ${badge.description}</div>
                            </div>
                            <div class="item-actions">
                                <button onclick="deleteBadge('${doc.id}')" class="px-3 py-1 bg-red-500 text-white text-xs rounded-lg">Ø­Ø°Ù</button>
                            </div>
                        </div>
                    `;
                });
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø§Ø±Ø§Øª:", error);
            }
        }

        async function loadLevelsList() {
            try {
                const levelsRef = collection(db, "levels");
                const querySnapshot = await getDocs(query(levelsRef, orderBy("levelNumber")));
                const container = document.getElementById('levelsList');
                container.innerHTML = '';
                
                querySnapshot.forEach(doc => {
                    const level = doc.data();
                    const typeName = level.type === 'wealth' ? 'Ø«Ø±ÙˆØ©' : level.type === 'magic' ? 'Ø³Ø­Ø±' : 'Ø´Ø­Ù†';
                    
                    container.innerHTML += `
                        <div class="item-row">
                            <img src="${level.image || 'https://via.placeholder.com/150'}" class="item-image" onerror="this.src='https://via.placeholder.com/150'">
                            <div class="item-info">
                                <div class="item-name">${level.name} (${typeName} - Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${level.levelNumber})</div>
                                <div class="item-meta">Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ${level.required.toLocaleString()} Ø¹Ù…Ù„Ø©</div>
                            </div>
                            <div class="item-actions">
                                <button onclick="deleteLevel('${doc.id}')" class="px-3 py-1 bg-red-500 text-white text-xs rounded-lg">Ø­Ø°Ù</button>
                            </div>
                        </div>
                    `;
                });
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª:", error);
            }
        }

        async function loadUsersList() {
            try {
                const usersRef = collection(db, "users");
                const querySnapshot = await getDocs(query(usersRef, orderBy("createdAt", "desc")));
                const container = document.getElementById('usersList');
                container.innerHTML = '';
                
                querySnapshot.forEach(doc => {
                    const user = doc.data();
                    container.innerHTML += `
                        <div class="item-row">
                            <img src="${user.photoURL || 'https://i.pravatar.cc/150'}" class="item-image rounded-full">
                            <div class="item-info">
                                <div class="item-name">${user.displayName}</div>
                                <div class="item-meta">${user.email} | ID: ${user.customId || user.uid.substring(0,8)}</div>
                                <div class="item-meta">Ø±ØµÙŠØ¯: ${user.balance?.toLocaleString()} | Ø«Ø±ÙˆØ©: ${user.wealthLv} | Ø³Ø­Ø±: ${user.magicLv}</div>
                            </div>
                            <div class="item-actions">
                                <button onclick="editUser('${doc.id}')" class="px-3 py-1 bg-blue-500 text-white text-xs rounded-lg">ØªØ¹Ø¯ÙŠÙ„</button>
                            </div>
                        </div>
                    `;
                });
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:", error);
            }
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
        function resetFrameForm() {
            document.getElementById('frameName').value = '';
            document.getElementById('framePrice').value = '';
            document.getElementById('frameImage').value = '';
            document.getElementById('frameDescription').value = '';
        }

        function resetBadgeForm() {
            document.getElementById('badgeName').value = '';
            document.getElementById('badgePrice').value = '';
            document.getElementById('badgeIcon').value = '';
            document.getElementById('badgeDescription').value = '';
        }

        function resetLevelForm() {
            document.getElementById('levelNumber').value = '';
            document.getElementById('levelRequired').value = '';
            document.getElementById('levelImage').value = '';
            document.getElementById('levelName').value = '';
        }
    </script>

    <!-- JavaScript Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© -->
    <script>
        // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ù†Ø±Ø§Øª
        function displayBanners(banners) {
            const container = document.getElementById('bannerContainer');
            container.innerHTML = '';
            
            if (banners.length === 0) return;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ù†Ø± Ø§Ù„Ø£ÙˆÙ„ ÙÙ‚Ø· (ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡ Ù„Ø¹Ø±Ø¶ Ø¹Ø¯Ø© Ø¨Ù†Ø±Ø§Øª)
            const banner = banners[0];
            container.innerHTML = `
                <a href="${banner.link}" target="_blank" class="banner-link">
                    <img src="${banner.imageUrl}" class="banner-image" onerror="this.src='https://images.unsplash.com/photo-1518709268805-4e9042af2176?q=80&w=1000'">
                </a>
            `;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        function updateUI(userData) {
            try {
                window.currentUserData = userData;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                document.getElementById('userName').innerText = userData.displayName || 'Ù…Ø³ØªØ®Ø¯Ù…';
                document.getElementById('userEmail').innerText = userData.email || '';
                document.getElementById('userAvatar').src = userData.photoURL || 'https://i.pravatar.cc/150';
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ ID Ù…Ø¹ Ø§Ù„Ø®Ù„ÙÙŠØ©
                const idBadge = document.getElementById('userIDBadge');
                idBadge.innerHTML = `
                    <div class="copy-btn" onclick="copyUserId()">
                        <i data-lucide="copy" class="w-3 h-3"></i>
                    </div>
                    <span id="userID">${userData.customId || userData.uid.substring(0, 8)}</span>
                `;
                
                if (userData.idBackground) {
                    idBadge.style.backgroundImage = `url('${userData.idBackground}')`;
                    idBadge.style.backgroundSize = 'cover';
                    idBadge.style.backgroundPosition = 'center';
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯ ÙˆØ§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª
                const balance = userData.balance || 0;
                const wealthLv = userData.wealthLv || 1;
                const magicLv = userData.magicLv || 1;
                const rechargeLv = userData.rechargeLv || 1;
                
                document.getElementById('header-balance').innerText = balance.toLocaleString();
                document.getElementById('wallet-balance-big').innerText = balance.toLocaleString();
                document.getElementById('wealth-lv').innerText = `Ø«Ø±ÙˆØ© LV ${wealthLv}`;
                document.getElementById('magic-lv').innerText = `Ø³Ø­Ø± LV ${magicLv}`;
                document.getElementById('recharge-lv').innerText = `Ø´Ø­Ù† LV ${rechargeLv}`;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ù†Ø´Ø·
                const activeFrameImg = document.getElementById('activeFrame');
                if (userData.activeFrame) {
                    const frame = window.storeItems.frames.find(f => f.id === userData.activeFrame);
                    if (frame) {
                        activeFrameImg.src = frame.image;
                        activeFrameImg.style.display = 'block';
                    } else {
                        activeFrameImg.style.display = 'none';
                    }
                } else {
                    activeFrameImg.style.display = 'none';
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Ø±Ø§Øª
                updateBadgesDisplay(userData.activeBadges || []);
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©:", error);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø±Ø§Øª
        function updateBadgesDisplay(activeBadges) {
            try {
                const container = document.getElementById('userBadges');
                container.innerHTML = '';
                
                // Ø¥Ù†Ø´Ø§Ø¡ 4 Ù…Ø±Ø¨Ø¹Ø§Øª Ù„Ù„Ø´Ø§Ø±Ø§Øª
                for (let i = 0; i < 4; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'badge-slot';
                    
                    if (i < activeBadges.length) {
                        const badgeId = activeBadges[i];
                        const badge = window.storeItems.badges.find(b => b.id === badgeId);
                        if (badge) {
                            slot.innerHTML = badge.icon;
                            slot.classList.add('has-badge');
                        }
                    }
                    
                    container.appendChild(slot);
                }
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Ø±Ø§Øª:", error);
            }
        }

        // Ù†Ø³Ø® Ø§Ù„Ù€ ID
        function copyUserId() {
            const id = window.currentUserData?.customId || window.currentUserData?.uid.substring(0, 8);
            navigator.clipboard.writeText(id).then(() => {
                showToast("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù€ ID", 'success');
            });
        }

        // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„
        function openEditProfile() {
            if (!window.currentUserData) return;
            
            document.getElementById('editUserName').value = window.currentUserData.displayName || '';
            document.getElementById('editUserAvatar').value = window.currentUserData.photoURL || '';
            document.getElementById('editUserId').value = window.currentUserData.customId || '';
            document.getElementById('editIdBackground').value = window.currentUserData.idBackground || '';
            
            document.getElementById('editProfileModal').classList.add('active');
        }

        function closeEditProfile() {
            document.getElementById('editProfileModal').classList.remove('active');
        }

        async function saveProfile() {
            try {
                const user = window.currentUserData;
                if (!user) return;
                
                const updates = {
                    displayName: document.getElementById('editUserName').value || user.displayName,
                    photoURL: document.getElementById('editUserAvatar').value || user.photoURL,
                    customId: document.getElementById('editUserId').value || user.customId,
                    idBackground: document.getElementById('editIdBackground').value || user.idBackground
                };
                
                // ØªØ­Ø¯ÙŠØ« ÙÙŠ Firestore
                const { doc, updateDoc, getFirestore } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
                const db = getFirestore();
                const userRef = doc(db, "users", user.uid);
                
                await updateDoc(userRef, updates);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                Object.assign(window.currentUserData, updates);
                updateUI(window.currentUserData);
                
                closeEditProfile();
                showToast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø¨Ù†Ø¬Ø§Ø­", 'success');
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ:", error);
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª", 'error');
            }
        }

        // Ø¹Ø±Ø¶ ØªØ¨ÙˆÙŠØ¨Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function showAdminTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            document.getElementById(`admin${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`).style.display = 'block';
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±
            event.target.classList.add('active');
        }

        // Ø¹Ø±Ø¶ Ø§Ù„ØºØ±Ù
        function renderRooms() {
            try {
                const container = document.getElementById('roomsContainer');
                container.innerHTML = "";
                const roomNames = [
                    "ØºØ±ÙØ© Ø§Ù„Ø£Ø­Ù„Ø§Ù…", "ØºØ±ÙØ© Ø§Ù„Ù†Ø¬ÙˆÙ…", "ØºØ±ÙØ© Ø§Ù„Ø³Ø­Ø±", 
                    "ØºØ±ÙØ© Ø§Ù„Ø°Ù‡Ø¨", "ØºØ±ÙØ© Ø§Ù„Ø£Ù„Ù…Ø§Ø³", "ØºØ±ÙØ© Ø§Ù„Ø£Ø³Ø±Ø§Ø±", "ØºØ±ÙØ© Ø§Ù„ØªØ­Ø¯ÙŠ"
                ];
                
                for (let i = 0; i < 7; i++) {
                    container.innerHTML += `
                        <div class="bg-white p-3 rounded-2xl border text-center shadow-sm hover:shadow-md transition-shadow">
                            <div class="relative">
                                <img src="https://picsum.photos/seed/room${i}/200" class="w-full h-24 object-cover rounded-xl mb-2">
                                <div class="absolute top-2 left-2 bg-black/50 text-white text-[10px] px-2 py-1 rounded-full">${i + 1}</div>
                            </div>
                            <div class="font-bold text-[11px]">${roomNames[i]}</div>
                            <button class="w-full bg-orange-500 text-white mt-2 py-1.5 rounded-lg text-[10px] font-bold hover:bg-orange-600">
                                Ø¯Ø®ÙˆÙ„
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„ØºØ±Ù:", error);
            }
        }

        // ØªØµÙÙŠØ© Ø§Ù„Ù…ØªØ¬Ø±
        function filterStore(type) {
            try {
                // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµÙÙŠØ©
                document.getElementById('framesBtn').className = type === 'frames' 
                    ? 'px-4 py-2 bg-orange-500 text-white rounded-xl text-xs font-bold'
                    : 'px-4 py-2 bg-gray-100 rounded-xl text-xs font-bold';
                
                document.getElementById('badgesBtn').className = type === 'badges'
                    ? 'px-4 py-2 bg-orange-500 text-white rounded-xl text-xs font-bold'
                    : 'px-4 py-2 bg-gray-100 rounded-xl text-xs font-bold';
                
                const container = document.getElementById('storeItems');
                container.innerHTML = "";
                const items = window.storeItems[type];
                
                if (!items || !window.currentUserData) {
                    container.innerHTML = '<div class="col-span-2 text-center py-8 text-gray-500">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>';
                    return;
                }
                
                items.forEach(item => {
                    const isOwned = type === 'frames' 
                        ? (window.currentUserData.purchasedFrames || []).includes(item.id)
                        : (window.currentUserData.purchasedBadges || []).includes(item.id);
                    
                    const isEquipped = type === 'frames'
                        ? window.currentUserData.activeFrame === item.id
                        : (window.currentUserData.activeBadges || []).includes(item.id);
                    
                    container.innerHTML += `
                        <div class="store-item ${isOwned ? 'owned' : ''} ${isEquipped ? 'equipped' : ''}" 
                             onclick="${isOwned ? 'equipItem' : 'buyItem'}(${JSON.stringify(item).replace(/'/g, "\\'")})">
                            <div class="text-3xl mb-2">${item.icon || `<img src="${item.image}" class="w-12 h-12 mx-auto">`}</div>
                            <div class="font-bold text-xs mb-1">${item.name}</div>
                            <div class="text-[10px] text-gray-500 mb-2">${item.description || ''}</div>
                            <div class="text-[10px] text-gray-500 mb-2">${item.price.toLocaleString()} ğŸ’°</div>
                            <button class="w-full ${isOwned ? (isEquipped ? 'bg-green-500' : 'bg-blue-500') : 'bg-orange-500'} 
                                        text-white py-2 rounded-xl text-[10px] font-bold hover:opacity-90">
                                ${isOwned ? (isEquipped ? 'ğŸ’ Ù…ÙÙØ¹Ù‘Ù„' : 'ØªÙØ¹ÙŠÙ„') : 'Ø´Ø±Ø§Ø¡'}
                            </button>
                        </div>
                    `;
                });
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø±:", error);
            }
        }

        // Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù†ØµØ±
        async function buyItem(item) {
            const { buyItem } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
            window.buyItem(item);
        }

        // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¹Ù†ØµØ±
        async function equipItem(item) {
            const { equipItem } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
            window.equipItem(item);
        }

        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        async function searchUsers() {
            const { searchUsers } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
            window.searchUsers();
        }

        // Ø§Ù„Ø´Ø­Ù†
        async function recharge(amount, dollars) {
            const { recharge } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
            window.recharge(amount, dollars);
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯
        function switchView(v) {
            document.querySelectorAll('.view-screen').forEach(s => s.classList.remove('active'));
            document.getElementById(`view-${v}`).classList.add('active');
            
            const titles = {
                'rooms': 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
                'wallet': 'Ø§Ù„Ù…Ø­ÙØ¸Ø©',
                'store': 'Ø§Ù„Ù…ØªØ¬Ø±',
                'admin': 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…'
            };
            document.getElementById('view-title').innerText = titles[v] || v;
            
            if (document.getElementById('sidebar').classList.contains('open')) toggleSidebar();
            if (document.getElementById('searchContainer').classList.contains('active')) toggleSearch();
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØªØ¬Ø±ØŒ Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ«Ù‡Ø§
            if (v === 'store') {
                setTimeout(() => filterStore('frames'), 100);
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…ØŒ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
            if (v === 'admin' && window.isAdmin) {
                setTimeout(() => {
                    showAdminTab('banners');
                    lucide.createIcons();
                }, 100);
            }
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø±
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('overlay').classList.toggle('active');
            lucide.createIcons();
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø­Ø«
        function toggleSearch() {
            const searchContainer = document.getElementById('searchContainer');
            searchContainer.classList.toggle('active');
            if (searchContainer.classList.contains('active')) {
                document.getElementById('searchInput').focus();
                const results = document.getElementById('searchResults');
                results.innerHTML = '<div class="text-center text-gray-500 py-4">Ø§ÙƒØªØ¨ ID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø¨Ø­Ø«</div>';
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function initApp() {
            renderRooms();
            filterStore('frames');
            lucide.createIcons();
            console.log("Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø²!");
        }

        // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = () => {
            lucide.createIcons();
        };
    </script>
</body>
</html>
